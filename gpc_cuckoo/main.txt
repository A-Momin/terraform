provider "aws" {
  region = "us-east-1"  # Update with your desired AWS region
}

# Define Lambda function
resource "aws_lambda_function" "gpc_cuckoo" {
  function_name = "gpc_cuckoo"
  runtime       = "python3.7"
  role          = "arn:aws:iam::583847744398:role/gpc_cuckoo_role"
  handler       = "cuckoo.handler"
  filename      = "package.zip"  # Update with the correct path to your package.zip
}

# Use the module for each CloudWatch Events rule
module "come_to_work" {
  source = "./modules"
  
  lambda_function_name = aws_lambda_function.gpc_cuckoo.function_name
  lambda_function_arn  = aws_lambda_function.gpc_cuckoo.arn
  event_rule_name      = "come_to_work"
  schedule_expression  = "cron(0 12 ? * MON-FRI *)"
  statement_id         = "1"
}

module "daily_tasks" {
  source = "./modules"
  
  lambda_function_name = aws_lambda_function.gpc_cuckoo.function_name
  lambda_function_arn  = aws_lambda_function.gpc_cuckoo.arn
  event_rule_name      = "daily_tasks"
  schedule_expression  = "cron(0 17 ? * MON-FRI *)"
  statement_id         = "2"
}

module "pickup" {
  source = "./modules"
  
  lambda_function_name = aws_lambda_function.gpc_cuckoo.function_name
  lambda_function_arn  = aws_lambda_function.gpc_cuckoo.arn
  event_rule_name      = "pickup"
  schedule_expression  = "cron(0 22 ? * MON-FRI *)"
  statement_id         = "3"
}
